{% extends "base.html" %}

{% block title %}Suppliers - SupplyChainX{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Suppliers</h1>
        <div>
            <button class="btn btn-outline-secondary" onclick="exportSuppliers()">
                <i class="bi bi-download"></i> Export
            </button>
            <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#onboardingWizardModal">
                <i class="bi bi-person-plus"></i> Onboard Supplier
            </button>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
                <i class="bi bi-plus-circle"></i> Add Supplier
            </button>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4" id="supplierSummary">
        <div class="col-md-3">
            <div class="card summary-card">
                <div class="card-body text-center">
                    <h3 class="text-primary" id="totalSuppliers">0</h3>
                    <p class="mb-0">Total Suppliers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card summary-card">
                <div class="card-body text-center">
                    <h3 class="text-success" id="activeSuppliers">0</h3>
                    <p class="mb-0">Active</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card summary-card">
                <div class="card-body text-center">
                    <h3 class="text-warning" id="atRiskSuppliers">0</h3>
                    <p class="mb-0">At Risk</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card summary-card">
                <div class="card-body text-center">
                    <h3 class="text-info" id="avgRating">0.0</h3>
                    <p class="mb-0">Avg Rating</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card filter-card">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="supplierSearch" placeholder="Search suppliers...">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="ratingFilter">
                        <option value="">All Ratings</option>
                        <option value="4">4+ Stars</option>
                        <option value="3">3+ Stars</option>
                        <option value="2">2+ Stars</option>
                        <option value="1">1+ Stars</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="raw_materials">Raw Materials</option>
                        <option value="components">Components</option>
                        <option value="packaging">Packaging</option>
                        <option value="logistics">Logistics</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                    <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Suppliers Grid -->
    <div class="row" id="suppliersGrid">
        <!-- Dynamic content will be loaded here -->
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="text-center py-5" style="display: none;">
        <i class="bi bi-building text-muted" style="font-size: 3rem;"></i>
        <h4 class="mt-3 text-muted">No Suppliers Found</h4>
        <p class="text-muted">Get started by adding your first supplier</p>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
            <i class="bi bi-plus-circle"></i> Add Supplier
        </button>
    </div>

    <!-- Pagination -->
    <nav id="pagination" style="display: none;">
        <ul class="pagination justify-content-center">
            <!-- Dynamic pagination will be inserted here -->
        </ul>
    </nav>
</div>

<!-- Add Supplier Modal -->
<div class="modal fade" id="addSupplierModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Supplier</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addSupplierForm" novalidate>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-control" name="name" required>
                            <div class="invalid-feedback">Please enter a company name.</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Contact Person</label>
                            <input type="text" class="form-control" name="contact_person">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" name="email" required>
                            <div class="invalid-feedback">Please enter a valid email address.</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phone">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category">
                                <option value="">Select category...</option>
                                <option value="raw_materials">Raw Materials</option>
                                <option value="components">Components</option>
                                <option value="packaging">Packaging</option>
                                <option value="logistics">Logistics</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" name="country">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" name="address" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addSupplier()" id="addSupplierBtn">
                    <span class="spinner-border spinner-border-sm me-2" style="display: none;"></span>
                    Add Supplier
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Supplier Modal -->
<div class="modal fade" id="editSupplierModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Supplier</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editSupplierForm" novalidate>
                    <input type="hidden" name="supplier_id">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-control" name="name" required>
                            <div class="invalid-feedback">Please enter a company name.</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Contact Person</label>
                            <input type="text" class="form-control" name="contact_person">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" name="email" required>
                            <div class="invalid-feedback">Please enter a valid email address.</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phone">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category">
                                <option value="">Select category...</option>
                                <option value="raw_materials">Raw Materials</option>
                                <option value="components">Components</option>
                                <option value="packaging">Packaging</option>
                                <option value="logistics">Logistics</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" name="country">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" name="address" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateSupplier()" id="updateSupplierBtn">
                    <span class="spinner-border spinner-border-sm me-2" style="display: none;"></span>
                    Update Supplier
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Supplier Onboarding Wizard Modal -->
<div class="modal fade" id="onboardingWizardModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Supplier Onboarding Wizard</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Progress Steps -->
                <div class="onboarding-steps mb-4">
                    <div class="row text-center">
                        <div class="col step-item active" data-step="1">
                            <div class="step-circle">1</div>
                            <small>Company Info</small>
                        </div>
                        <div class="col step-item" data-step="2">
                            <div class="step-circle">2</div>
                            <small>Capabilities</small>
                        </div>
                        <div class="col step-item" data-step="3">
                            <div class="step-circle">3</div>
                            <small>Compliance</small>
                        </div>
                        <div class="col step-item" data-step="4">
                            <div class="step-circle">4</div>
                            <small>Financial</small>
                        </div>
                        <div class="col step-item" data-step="5">
                            <div class="step-circle">5</div>
                            <small>Review</small>
                        </div>
                    </div>
                    <div class="progress mt-3">
                        <div class="progress-bar" id="onboardingProgress" role="progressbar" style="width: 20%"></div>
                    </div>
                </div>

                <form id="onboardingForm" novalidate>
                    <!-- Step 1: Company Information -->
                    <div class="onboarding-step" id="step1">
                        <h6 class="mb-3">Company Information</h6>
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label">Company Name *</label>
                                <input type="text" class="form-control" name="company_name" required>
                                <div class="invalid-feedback">Please enter the company name.</div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Supplier Code</label>
                                <input type="text" class="form-control" name="supplier_code" placeholder="Auto-generated if empty">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Primary Contact Name *</label>
                                <input type="text" class="form-control" name="contact_name" required>
                                <div class="invalid-feedback">Please enter the primary contact name.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Job Title</label>
                                <input type="text" class="form-control" name="contact_title">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" name="email" required>
                                <div class="invalid-feedback">Please enter a valid email address.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" name="phone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Country *</label>
                                <select class="form-select" name="country" required>
                                    <option value="">Select Country</option>
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="MX">Mexico</option>
                                    <option value="GB">United Kingdom</option>
                                    <option value="DE">Germany</option>
                                    <option value="FR">France</option>
                                    <option value="CN">China</option>
                                    <option value="IN">India</option>
                                    <option value="JP">Japan</option>
                                </select>
                                <div class="invalid-feedback">Please select a country.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" name="city">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" name="address" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Website</label>
                                <input type="url" class="form-control" name="website" placeholder="https://">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Company Size</label>
                                <select class="form-select" name="company_size">
                                    <option value="">Select Size</option>
                                    <option value="startup">Startup (1-10 employees)</option>
                                    <option value="small">Small (11-50 employees)</option>
                                    <option value="medium">Medium (51-200 employees)</option>
                                    <option value="large">Large (201-1000 employees)</option>
                                    <option value="enterprise">Enterprise (1000+ employees)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Capabilities -->
                    <div class="onboarding-step d-none" id="step2">
                        <h6 class="mb-3">Capabilities & Services</h6>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Primary Categories *</label>
                                <div class="category-selection">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="raw_materials" id="cat1">
                                        <label class="form-check-label" for="cat1">Raw Materials</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="components" id="cat2">
                                        <label class="form-check-label" for="cat2">Components</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="packaging" id="cat3">
                                        <label class="form-check-label" for="cat3">Packaging</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="logistics" id="cat4">
                                        <label class="form-check-label" for="cat4">Logistics</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="manufacturing" id="cat5">
                                        <label class="form-check-label" for="cat5">Manufacturing</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" name="categories" value="services" id="cat6">
                                        <label class="form-check-label" for="cat6">Services</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Production Capacity</label>
                                <div id="capacityInputs">
                                    <div class="capacity-row row g-2 mb-2">
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" name="capacity_type[]" placeholder="Product/Service Type">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="number" class="form-control" name="capacity_amount[]" placeholder="Capacity">
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" name="capacity_unit[]">
                                                <option value="">Unit</option>
                                                <option value="units/month">Units/Month</option>
                                                <option value="kg/month">Kg/Month</option>
                                                <option value="tons/month">Tons/Month</option>
                                                <option value="m3/month">M³/Month</option>
                                                <option value="orders/month">Orders/Month</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeCapacityRow(this)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addCapacityRow()">
                                    <i class="bi bi-plus"></i> Add Capacity
                                </button>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Lead Time (days)</label>
                                <input type="number" class="form-control" name="lead_time" min="1">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Minimum Order Quantity</label>
                                <input type="number" class="form-control" name="min_order_qty" min="1">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Special Capabilities</label>
                                <textarea class="form-control" name="special_capabilities" rows="3" 
                                          placeholder="Describe any special manufacturing processes, certifications, or unique capabilities..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Compliance & Certifications -->
                    <div class="onboarding-step d-none" id="step3">
                        <h6 class="mb-3">Compliance & Certifications</h6>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Quality Certifications</label>
                                <div class="certification-selection">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="iso9001" id="cert1">
                                        <label class="form-check-label" for="cert1">ISO 9001 (Quality Management)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="iso14001" id="cert2">
                                        <label class="form-check-label" for="cert2">ISO 14001 (Environmental)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="iso45001" id="cert3">
                                        <label class="form-check-label" for="cert3">ISO 45001 (Health & Safety)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="iatf16949" id="cert4">
                                        <label class="form-check-label" for="cert4">IATF 16949 (Automotive)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="as9100" id="cert5">
                                        <label class="form-check-label" for="cert5">AS9100 (Aerospace)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="certifications" value="fsc" id="cert6">
                                        <label class="form-check-label" for="cert6">FSC (Forest Stewardship)</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ESG Compliance Level</label>
                                <select class="form-select" name="esg_level">
                                    <option value="">Select Level</option>
                                    <option value="basic">Basic Compliance</option>
                                    <option value="advanced">Advanced ESG Practices</option>
                                    <option value="certified">Certified ESG Leader</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Data Security Level</label>
                                <select class="form-select" name="security_level">
                                    <option value="">Select Level</option>
                                    <option value="basic">Basic Security</option>
                                    <option value="enhanced">Enhanced Security</option>
                                    <option value="government">Government Grade</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Compliance Documentation</label>
                                <div class="border rounded p-3 bg-light">
                                    <input type="file" class="form-control" name="compliance_docs" multiple accept=".pdf,.doc,.docx">
                                    <small class="text-muted">Upload compliance certificates, audit reports, etc. (PDF, DOC)</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Financial Information -->
                    <div class="onboarding-step d-none" id="step4">
                        <h6 class="mb-3">Financial Information</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Preferred Payment Terms</label>
                                <select class="form-select" name="payment_terms">
                                    <option value="">Select Terms</option>
                                    <option value="net30">Net 30</option>
                                    <option value="net45">Net 45</option>
                                    <option value="net60">Net 60</option>
                                    <option value="prepayment">Prepayment Required</option>
                                    <option value="cod">Cash on Delivery</option>
                                    <option value="custom">Custom Terms</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Credit Rating</label>
                                <select class="form-select" name="credit_rating">
                                    <option value="">Select Rating</option>
                                    <option value="aaa">AAA (Excellent)</option>
                                    <option value="aa">AA (Very Good)</option>
                                    <option value="a">A (Good)</option>
                                    <option value="bbb">BBB (Adequate)</option>
                                    <option value="bb">BB (Below Average)</option>
                                    <option value="b">B (Poor)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Annual Revenue (USD)</label>
                                <select class="form-select" name="annual_revenue">
                                    <option value="">Select Range</option>
                                    <option value="under_1m">Under $1M</option>
                                    <option value="1m_10m">$1M - $10M</option>
                                    <option value="10m_100m">$10M - $100M</option>
                                    <option value="100m_1b">$100M - $1B</option>
                                    <option value="over_1b">Over $1B</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Currency</label>
                                <select class="form-select" name="currency">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="CAD">CAD</option>
                                    <option value="CNY">CNY</option>
                                    <option value="JPY">JPY</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="insurance_required" id="insurance">
                                    <label class="form-check-label" for="insurance">
                                        Business Insurance Required
                                    </label>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Banking Information</label>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="bank_name" placeholder="Bank Name">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="bank_account" placeholder="Account Number">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Review -->
                    <div class="onboarding-step d-none" id="step5">
                        <h6 class="mb-3">Review & Submit</h6>
                        <div id="reviewContent">
                            <!-- Content populated by JavaScript -->
                        </div>
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" name="terms_agreed" id="termsAgreed" required>
                            <label class="form-check-label" for="termsAgreed">
                                I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">Privacy Policy</a>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">Previous</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next</button>
                <button type="button" class="btn btn-success d-none" id="submitBtn" onclick="submitOnboarding()">
                    <span class="spinner-border spinner-border-sm me-2 d-none"></span>
                    Submit Application
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Onboarding wizard functionality
let currentStep = 1;
const totalSteps = 5;

function showOnboardingWizard() {
    const modal = new bootstrap.Modal(document.getElementById('onboardingWizardModal'));
    resetWizard();
    modal.show();
}

function resetWizard() {
    currentStep = 1;
    updateStepDisplay();
    document.getElementById('onboardingForm').reset();
    clearValidation();
}

function nextStep() {
    if (validateCurrentStep()) {
        if (currentStep < totalSteps) {
            currentStep++;
            updateStepDisplay();
        }
    }
}

function previousStep() {
    if (currentStep > 1) {
        currentStep--;
        updateStepDisplay();
    }
}

function updateStepDisplay() {
    // Hide all steps
    document.querySelectorAll('.onboarding-step').forEach(step => {
        step.classList.add('d-none');
    });
    
    // Show current step
    document.getElementById(`step${currentStep}`).classList.remove('d-none');
    
    // Update step indicators
    document.querySelectorAll('.step-item').forEach((item, index) => {
        item.classList.remove('active', 'completed');
        if (index + 1 < currentStep) {
            item.classList.add('completed');
        } else if (index + 1 === currentStep) {
            item.classList.add('active');
        }
    });
    
    // Update progress bar
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById('onboardingProgress').style.width = `${progress}%`;
    document.getElementById('onboardingProgress').setAttribute('aria-valuenow', progress);
    
    // Update buttons
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    
    prevBtn.style.display = currentStep > 1 ? 'inline-block' : 'none';
    nextBtn.style.display = currentStep < totalSteps ? 'inline-block' : 'none';
    submitBtn.classList.toggle('d-none', currentStep !== totalSteps);
    
    // Special handling for review step
    if (currentStep === totalSteps) {
        populateReview();
    }
}

function validateCurrentStep() {
    const currentStepElement = document.getElementById(`step${currentStep}`);
    const requiredFields = currentStepElement.querySelectorAll('[required]');
    let isValid = true;
    
    clearValidation();
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
            field.classList.add('is-valid');
        }
    });
    
    // Special validation for step 2 (categories)
    if (currentStep === 2) {
        const categories = currentStepElement.querySelectorAll('input[name="categories"]:checked');
        if (categories.length === 0) {
            showAlert('Please select at least one primary category.', 'warning');
            isValid = false;
        }
    }
    
    // Email validation
    const emailField = currentStepElement.querySelector('input[type="email"]');
    if (emailField && emailField.value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailField.value)) {
            emailField.classList.add('is-invalid');
            isValid = false;
        }
    }
    
    return isValid;
}

function clearValidation() {
    document.querySelectorAll('.is-invalid, .is-valid').forEach(element => {
        element.classList.remove('is-invalid', 'is-valid');
    });
}

function populateReview() {
    const formData = new FormData(document.getElementById('onboardingForm'));
    const reviewContent = document.getElementById('reviewContent');
    
    let html = '<div class="row g-3">';
    
    // Company Information
    html += '<div class="col-12"><h6 class="text-primary">Company Information</h6>';
    html += `<p><strong>Company:</strong> ${formData.get('company_name') || 'Not specified'}</p>`;
    html += `<p><strong>Contact:</strong> ${formData.get('contact_name') || 'Not specified'} (${formData.get('email') || 'No email'})</p>`;
    html += `<p><strong>Location:</strong> ${formData.get('city') || 'Not specified'}, ${formData.get('country') || 'Not specified'}</p></div>`;
    
    // Capabilities
    html += '<div class="col-12"><h6 class="text-primary">Capabilities</h6>';
    const categories = Array.from(document.querySelectorAll('input[name="categories"]:checked')).map(cb => cb.nextElementSibling.textContent);
    html += `<p><strong>Categories:</strong> ${categories.join(', ') || 'None selected'}</p>`;
    html += `<p><strong>Lead Time:</strong> ${formData.get('lead_time') || 'Not specified'} days</p></div>`;
    
    // Compliance
    html += '<div class="col-12"><h6 class="text-primary">Compliance</h6>';
    const certifications = Array.from(document.querySelectorAll('input[name="certifications"]:checked')).map(cb => cb.nextElementSibling.textContent);
    html += `<p><strong>Certifications:</strong> ${certifications.join(', ') || 'None selected'}</p></div>`;
    
    // Financial
    html += '<div class="col-12"><h6 class="text-primary">Financial</h6>';
    html += `<p><strong>Payment Terms:</strong> ${formData.get('payment_terms') || 'Not specified'}</p>`;
    html += `<p><strong>Credit Rating:</strong> ${formData.get('credit_rating') || 'Not specified'}</p></div>`;
    
    html += '</div>';
    reviewContent.innerHTML = html;
}

function addCapacityRow() {
    const container = document.getElementById('capacityInputs');
    const newRow = document.createElement('div');
    newRow.className = 'capacity-row row g-2 mb-2';
    newRow.innerHTML = [
        '<div class="col-md-4">',
            '<input type="text" class="form-control" name="capacity_type[]" placeholder="Product/Service Type">',
        '</div>',
        '<div class="col-md-3">',
            '<input type="number" class="form-control" name="capacity_amount[]" placeholder="Capacity">',
        '</div>',
        '<div class="col-md-3">',
            '<select class="form-select" name="capacity_unit[]" aria-label="Capacity unit">',
                '<option value="">Unit</option>',
                '<option value="units/month">Units/Month</option>',
                '<option value="kg/month">Kg/Month</option>',
                '<option value="tons/month">Tons/Month</option>',
                '<option value="m3/month">M³/Month</option>',
                '<option value="orders/month">Orders/Month</option>',
            '</select>',
        '</div>',
        '<div class="col-md-2">',
            '<button type="button" class="btn btn-outline-danger btn-sm" onclick="removeCapacityRow(this)" title="Remove capacity row" aria-label="Remove">',
                '<i class="bi bi-trash"></i>',
            '</button>',
        '</div>'
    ].join('');
    container.appendChild(newRow);
}

function removeCapacityRow(button) {
    const rows = document.querySelectorAll('.capacity-row');
    if (rows.length > 1) {
        button.closest('.capacity-row').remove();
    }
}

function submitOnboarding() {
    if (!validateCurrentStep()) {
        return;
    }
    
    const submitBtn = document.getElementById('submitBtn');
    const spinner = submitBtn.querySelector('.spinner-border');
    const formData = new FormData(document.getElementById('onboardingForm'));
    
    // Show loading state
    submitBtn.disabled = true;
    spinner.classList.remove('d-none');
    
    // Prepare data for submission
    const supplierData = {
        name: formData.get('company_name'),
        code: formData.get('supplier_code') || generateSupplierCode(formData.get('company_name')),
        email: formData.get('email'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        city: formData.get('city'),
        country: formData.get('country'),
        website: formData.get('website'),
        contact_name: formData.get('contact_name'),
        contact_title: formData.get('contact_title'),
        company_size: formData.get('company_size'),
        categories: Array.from(document.querySelectorAll('input[name="categories"]:checked')).map(cb => cb.value),
        certifications: Array.from(document.querySelectorAll('input[name="certifications"]:checked')).map(cb => cb.value),
        lead_time: parseInt(formData.get('lead_time')) || null,
        min_order_qty: parseInt(formData.get('min_order_qty')) || null,
        payment_terms: formData.get('payment_terms'),
        credit_rating: formData.get('credit_rating'),
        annual_revenue: formData.get('annual_revenue'),
        currency: formData.get('currency'),
        esg_level: formData.get('esg_level'),
        security_level: formData.get('security_level'),
        status: 'pending_approval'
    };
    
    // Submit to API
    fetch('/api/suppliers', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(supplierData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Supplier application submitted successfully! You will be notified once approved.', 'success');
            bootstrap.Modal.getInstance(document.getElementById('onboardingWizardModal')).hide();
            loadSuppliers(); // Refresh the suppliers list
        } else {
            throw new Error(data.message || 'Failed to submit application');
        }
    })
    .catch(error => {
        console.error('Error submitting supplier:', error);
        showAlert('Error submitting application: ' + error.message, 'danger');
    })
    .finally(() => {
        submitBtn.disabled = false;
        spinner.classList.add('d-none');
    });
}

function generateSupplierCode(companyName) {
    if (!companyName) return 'SUP' + Date.now().toString().slice(-6);
    
    const words = companyName.toUpperCase().split(' ').filter(word => word.length > 0);
    let code = 'SUP';
    
    if (words.length === 1) {
        code += words[0].slice(0, 3);
    } else {
        code += words.slice(0, 3).map(word => word.charAt(0)).join('');
    }
    
    code += Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    return code;
}

function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = [
        message,
        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>'
    ].join('');
    
    // Insert at top of modal body or page
    const target = document.querySelector('.modal-body') || document.querySelector('.container-fluid');
    target.insertBefore(alertDiv, target.firstChild);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// Global variables
let allSuppliers = [];
let filteredSuppliers = [];
let currentPage = 1;
const itemsPerPage = 9;

// Initialize page when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    loadSuppliers();
    
    // Add search event listener
    document.getElementById('supplierSearch').addEventListener('input', function() {
        applyFilters();
    });
    
    // Add styles for wizard
    const style = document.createElement('style');
    style.textContent = `
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 8px;
            transition: all 0.3s ease;
        }
        .step-item.active .step-circle {
            background: #0d6efd;
            color: white;
        }
        .step-item.completed .step-circle {
            background: #198754;
            color: white;
        }
        .supplier-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #0d6efd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .category-selection .form-check {
            margin-bottom: 0.5rem;
        }
        .certification-selection .form-check {
            margin-bottom: 0.5rem;
        }
        .onboarding-steps small {
            font-size: 0.75rem;
            color: #6c757d;
        }
        .step-item.active small {
            color: #0d6efd;
        }
        .step-item.completed small {
            color: #198754;
        }
        .wizard-hidden {
            display: none !important;
        }
    `;
    document.head.appendChild(style);
});

// Load suppliers from API
function loadSuppliers() {
    showLoading(true);
    
    fetch('/api/suppliers')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Loaded suppliers:', data); // Debug log
            if (data.suppliers && Array.isArray(data.suppliers)) {
                allSuppliers = data.suppliers;
                filteredSuppliers = [...allSuppliers];
                renderSuppliers();
                updateSummaryCards();
            } else {
                console.error('Invalid supplier data structure:', data);
                showError('Invalid data received from server');
            }
        })
        .catch(error => {
            console.error('Error loading suppliers:', error);
            showError('Failed to load suppliers: ' + error.message);
        })
        .finally(() => {
            showLoading(false);
        });
}

// Render suppliers grid
function renderSuppliers() {
    const grid = document.getElementById('suppliersGrid');
    const emptyState = document.getElementById('emptyState');
    const pagination = document.getElementById('pagination');
    
    if (filteredSuppliers.length === 0) {
        grid.innerHTML = '';
        emptyState.style.display = 'block';
        pagination.style.display = 'none';
        return;
    }
    
    emptyState.style.display = 'none';
    
    // Calculate pagination
    const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const suppliersToShow = filteredSuppliers.slice(startIndex, endIndex);
    
    // Render supplier cards
    grid.innerHTML = suppliersToShow.map(supplier => createSupplierCard(supplier)).join('');
    
    // Show pagination if needed
    if (totalPages > 1) {
        renderPagination(totalPages);
        pagination.style.display = 'block';
    } else {
        pagination.style.display = 'none';
    }
}

// Create supplier card HTML
function createSupplierCard(supplier) {
    // Map API fields to expected fields with safe defaults
    const status = supplier.is_active ? 'active' : 'inactive';
    const rating = supplier.quality_rating || 0;
    
    // Use on_time_percentage if available, otherwise fall back to ontime_delivery_rate
    let onTimePercentage = supplier.on_time_percentage || supplier.ontime_delivery_rate || 0;
    // Convert to percentage if it's a decimal (0.0-1.0)
    if (onTimePercentage <= 1) {
        onTimePercentage = onTimePercentage * 100;
    }
    
    const totalOrders = supplier.total_orders || 0;
    const totalVolume = supplier.total_volume || 0;
    
    const statusBadge = getStatusBadge(status);
    const stars = renderStars(rating);
    
    // Handle categories - could be array or string
    let category = 'GENERAL';
    if (supplier.categories && supplier.categories.length > 0) {
        category = supplier.categories[0].replace('_', ' ').toUpperCase();
    } else if (supplier.category) {
        category = supplier.category.replace('_', ' ').toUpperCase();
    }
    
    // Determine performance classes
    const onTimeClass = onTimePercentage >= 95 ? 'performance-good' : 
                       onTimePercentage >= 85 ? 'performance-warning' : 'performance-danger';
    
    return `
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card supplier-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="card-title">${supplier.name || 'Unknown Supplier'}</h5>
                        ${statusBadge}
                    </div>
                    
                    <div class="supplier-rating">
                        <div class="d-flex align-items-center">
                            <span class="stars">${stars}</span>
                            <span class="rating-value">${rating.toFixed(1)}</span>
                        </div>
                    </div>
                    
                    <p class="supplier-category mb-3">${category}</p>
                    
                    <div class="supplier-metrics">
                        <div class="row">
                            <div class="col-4 metric">
                                <div class="metric-value ${onTimeClass}">${onTimePercentage.toFixed(0)}%</div>
                                <div class="metric-label">On-Time</div>
                            </div>
                            <div class="col-4 metric">
                                <div class="metric-value">${totalOrders}</div>
                                <div class="metric-label">Orders</div>
                            </div>
                            <div class="col-4 metric">
                                <div class="metric-value">${formatCurrency(totalVolume)}</div>
                                <div class="metric-label">Volume</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="supplier-actions">
                        <div class="d-grid gap-2">
                            <div class="btn-group" role="group">
                                <a href="/supplier/${supplier.id}" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-eye me-1"></i>View
                                </a>
                                <button class="btn btn-outline-secondary btn-sm" onclick="editSupplier(${supplier.id})" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Helper functions
function getStatusBadge(status) {
    const badges = {
        'active': '<span class="badge status-active">Active</span>',
        'inactive': '<span class="badge status-inactive">Inactive</span>',
        'suspended': '<span class="badge status-suspended">Suspended</span>'
    };
    return badges[status] || '<span class="badge status-inactive">Unknown</span>';
}

function renderStars(rating) {
    // Handle null, undefined, or non-numeric values
    const numRating = parseFloat(rating) || 0;
    const fullStars = Math.floor(numRating);
    const hasHalfStar = numRating % 1 >= 0.5;
    let stars = '';
    
    for (let i = 0; i < 5; i++) {
        if (i < fullStars) {
            stars += '<i class="bi bi-star-fill"></i>';
        } else if (i === fullStars && hasHalfStar) {
            stars += '<i class="bi bi-star-half"></i>';
        } else {
            stars += '<i class="bi bi-star"></i>';
        }
    }
    
    return stars;
}

function formatCurrency(amount) {
    // Handle null, undefined, or non-numeric values
    const numAmount = parseFloat(amount) || 0;
    
    if (numAmount >= 1000000) {
        return '$' + (numAmount / 1000000).toFixed(1) + 'M';
    } else if (numAmount >= 1000) {
        return '$' + (numAmount / 1000).toFixed(0) + 'K';
    }
    return '$' + numAmount.toFixed(0);
}

// Update summary cards
function updateSummaryCards() {
    const totalSuppliers = allSuppliers.length;
    const activeSuppliers = allSuppliers.filter(s => s.is_active === true).length;
    
    // Calculate at-risk suppliers (on-time percentage < 90%)
    const atRiskSuppliers = allSuppliers.filter(s => {
        let onTimePercentage = s.on_time_percentage || s.ontime_delivery_rate || 0;
        // Convert to percentage if it's a decimal (0.0-1.0)
        if (onTimePercentage <= 1) {
            onTimePercentage = onTimePercentage * 100;
        }
        return onTimePercentage < 90;
    }).length;
    
    const avgRating = totalSuppliers > 0 ? 
        (allSuppliers.reduce((sum, s) => sum + (s.quality_rating || 0), 0) / totalSuppliers) : 0;
    
    document.getElementById('totalSuppliers').textContent = totalSuppliers;
    document.getElementById('activeSuppliers').textContent = activeSuppliers;
    document.getElementById('atRiskSuppliers').textContent = atRiskSuppliers;
    document.getElementById('avgRating').textContent = avgRating.toFixed(1);
}

// Filter functions
function applyFilters() {
    const search = document.getElementById('supplierSearch').value.toLowerCase();
    const status = document.getElementById('statusFilter').value;
    const category = document.getElementById('categoryFilter').value;
    const rating = document.getElementById('ratingFilter').value;
    
    filteredSuppliers = allSuppliers.filter(supplier => {
        const matchesSearch = !search || 
            supplier.name.toLowerCase().includes(search) ||
            (supplier.contact_person && supplier.contact_person.toLowerCase().includes(search)) ||
            (supplier.email && supplier.email.toLowerCase().includes(search));
        
        // Convert is_active boolean to status string
        const supplierStatus = supplier.is_active ? 'active' : 'inactive';
        const matchesStatus = !status || supplierStatus === status;
        
        // Handle categories array
        let supplierCategory = '';
        if (supplier.categories && supplier.categories.length > 0) {
            supplierCategory = supplier.categories[0];
        } else if (supplier.category) {
            supplierCategory = supplier.category;
        }
        const matchesCategory = !category || supplierCategory === category;
        
        const supplierRating = supplier.quality_rating || 0;
        const matchesRating = !rating || supplierRating >= parseFloat(rating);
        
        return matchesSearch && matchesStatus && matchesCategory && matchesRating;
    });
    
    currentPage = 1;
    renderSuppliers();
}

function clearFilters() {
    document.getElementById('supplierSearch').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('ratingFilter').value = '';
    document.getElementById('categoryFilter').value = '';
    applyFilters();
}

// Supplier CRUD operations
function addSupplier() {
    const form = document.getElementById('addSupplierForm');
    const btn = document.getElementById('addSupplierBtn');
    const spinner = btn.querySelector('.spinner-border');
    
    if (!validateForm(form)) {
        return;
    }
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Show loading
    btn.disabled = true;
    spinner.style.display = 'inline-block';
    
    fetch('/api/suppliers', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showError(data.error);
        } else {
            showSuccess('Supplier created successfully');
            form.reset();
            form.classList.remove('was-validated');
            bootstrap.Modal.getInstance(document.getElementById('addSupplierModal')).hide();
            loadSuppliers();
        }
    })
    .catch(error => {
        console.error('Error creating supplier:', error);
        showError('Failed to create supplier');
    })
    .finally(() => {
        btn.disabled = false;
        spinner.style.display = 'none';
    });
}

function editSupplier(supplierId) {
    const supplier = allSuppliers.find(s => s.id === supplierId);
    if (!supplier) return;
    
    const form = document.getElementById('editSupplierForm');
    const modal = new bootstrap.Modal(document.getElementById('editSupplierModal'));
    
    // Extract contact info if it's an object
    const contactInfo = supplier.contact_info || {};
    
    // Populate form with safe defaults
    form.querySelector('input[name="supplier_id"]').value = supplier.id;
    form.querySelector('input[name="name"]').value = supplier.name || '';
    form.querySelector('input[name="contact_person"]').value = contactInfo.contact_person || '';
    form.querySelector('input[name="email"]').value = contactInfo.email || supplier.email || '';
    form.querySelector('input[name="phone"]').value = contactInfo.phone || '';
    
    // Handle category - could be array or string
    let category = '';
    if (supplier.categories && supplier.categories.length > 0) {
        category = supplier.categories[0];
    } else if (supplier.category) {
        category = supplier.category;
    }
    form.querySelector('select[name="category"]').value = category;
    
    // Convert is_active boolean to status string
    const status = supplier.is_active ? 'active' : 'inactive';
    form.querySelector('select[name="status"]').value = status;
    
    form.querySelector('input[name="country"]').value = supplier.country || '';
    form.querySelector('textarea[name="address"]').value = contactInfo.address || '';
    
    modal.show();
}

function updateSupplier() {
    const form = document.getElementById('editSupplierForm');
    const btn = document.getElementById('updateSupplierBtn');
    const spinner = btn.querySelector('.spinner-border');
    
    if (!validateForm(form)) {
        return;
    }
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    const supplierId = data.supplier_id;
    delete data.supplier_id;
    
    // Show loading
    btn.disabled = true;
    spinner.style.display = 'inline-block';
    
    fetch(`/api/suppliers/${supplierId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showError(data.error);
        } else {
            showSuccess('Supplier updated successfully');
            form.reset();
            form.classList.remove('was-validated');
            bootstrap.Modal.getInstance(document.getElementById('editSupplierModal')).hide();
            loadSuppliers();
        }
    })
    .catch(error => {
        console.error('Error updating supplier:', error);
        showError('Failed to update supplier');
    })
    .finally(() => {
        btn.disabled = false;
        spinner.style.display = 'none';
    });
}

function deleteSupplier(supplierId) {
    const supplier = allSuppliers.find(s => s.id === supplierId);
    if (!supplier) return;
    
    if (confirm(`Are you sure you want to delete ${supplier.name}?`)) {
        fetch(`/api/suppliers/${supplierId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showError(data.error);
            } else {
                showSuccess('Supplier deleted successfully');
                loadSuppliers();
            }
        })
        .catch(error => {
            console.error('Error deleting supplier:', error);
            showError('Failed to delete supplier');
        });
    }
}

function exportSuppliers() {
    window.location.href = '/api/suppliers/export';
}

// Utility functions
function validateForm(form) {
    form.classList.add('was-validated');
    return form.checkValidity();
}

function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    const grid = document.getElementById('suppliersGrid');
    
    if (show) {
        spinner.style.display = 'block';
        // grid.style.display = 'none';
    } else {
        spinner.style.display = 'none';
        // grid.style.display = 'block';
    }
}

function showSuccess(message) {
    // Create and show toast notification
    const toast = createToast('Success', message, 'success');
    const toastEl = new bootstrap.Toast(toast);
    toastEl.show();
}

function showError(message) {
    // Create and show toast notification
    const toast = createToast('Error', message, 'danger');
    const toastEl = new bootstrap.Toast(toast);
    toastEl.show();
}

function createToast(title, message, type) {
    const toastContainer = document.querySelector('.toast-container') || createToastContainer();
    
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = [
        '<div class="d-flex">',
            '<div class="toast-body">',
                '<strong>' + title + ':</strong> ' + message,
            '</div>',
            '<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>',
        '</div>'
    ].join('');
    
    toastContainer.appendChild(toast);
    return toast;
}

function createToastContainer() {
    // Check if there's already a toast container from base template
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        container.style.zIndex = '1055';
        document.body.appendChild(container);
    }
    return container;
}

// Pagination
function renderPagination(totalPages) {
    const paginationList = document.querySelector('#pagination .pagination');
    let paginationHTML = '';
    
    // Previous button
    paginationHTML += `
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>
        </li>
    `;
    
    // Page numbers
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
            <li class="page-item ${currentPage === i ? 'active' : ''}">
                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
            </li>
        `;
    }
    
    // Next button
    paginationHTML += `
        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
        </li>
    `;
    
    paginationList.innerHTML = paginationHTML;
}

function changePage(page) {
    const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
    
    if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderSuppliers();
    }
}
</script>
{% endblock %}
